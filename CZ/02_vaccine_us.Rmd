---
title: "02_vaccine_us"
author: "Ziwei Crystal Zang"
date: "4/6/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
rm(list = ls())
source("CZ/04_vaccine_us_final.R")
```

```{r}
colours <- c("#E5F2DF", "#95C182", "#519A37", "#2D6814")
pop =  "all"
vstatus = "fully vaccinated"
data = us_states_vaccine
plot1 <- function(data, pop, vstatus){
  ggplot(data = filter(data, population== pop, status == vstatus),
            aes(x = long, y = lat,
                group = group, fill = percent,  text = paste0(region,": ",  percent, "% are vaccinated") ))+
  geom_polygon(color = "gray90", size = 0.1) +
    coord_map(projection = "albers", lat0 = 39, lat1 = 45)+
  labs(title=paste0("Vaccination Status in the U.S. Among ", "18+"),
        x =" ", y = " ")+
      theme_void()+
  scale_fill_gradient2(low = "white", mid = "#67A24D", high = "#3B6824", midpoint = 50,limits=c(0, 100), breaks=seq(0,100,by=20))
}

plot1(data, pop, vstatus)

p1<- plot1(data=us_states_vaccine, pop = "65+", vstatus= "fully vaccinated")

ggplotly(p1, tooltip = c("text")) %>% 
  layout(legend = list(font = list(size=11)))



p2 <- plot1.quantile(data=us_states_vaccine, pop = "all", vstatus= "at least one dose")

ggplotly(p2, tooltip = c("text")) %>% 
  layout(legend = list(font = list(size=11)))

```

```{r}
plot2 <- function(data = us_states_brand, vbrand = vbrand){
  data <- data %>%
    filter(brand ==vbrand)
  ggplot(data ,
           aes(x = long, y = lat,
               fill = percent,  text = paste0(region,": ",  percent, "% are vaccinated with ", vbrand)))+
      geom_polygon(color = "gray90", size = 0.1) +
      coord_map(projection = "albers", lat0 = 39, lat1 = 45)+
      labs(title=paste0("Vaccination Status in the U.S. By ", vbrand),
           x =" ", y = " ")+
      theme_void()+
      scale_fill_gradient2(low = "white", mid = "#67A24D", high = "#3B6824",
                           midpoint = 50,limits=c(0, 80), breaks=seq(0,80,by=20))+
      theme(legend.title = element_text( size = 18),
            legend.text = element_text(size = 13),
            plot.title = element_text(size=18))+
      labs(fill = "Percent (%)")
}

plot2(data = us_states_brand, vbrand = "Pfizer")

plot2.quantile <- function(data , vbrand = vbrand){
  data <- data %>%
    filter(brand ==vbrand)
   ggplot(data = filter(us_states_brand, brand == vbrand),
                    aes(x = long, y = lat,
                         fill = percent_q,  text = paste0(region,": ",  percent, "% are vaccinated with ", vbrand)))+
      geom_polygon(color = "gray90", size = 0.1) +
      coord_map(projection = "albers", lat0 = 39, lat1 = 45)+
      labs(title=paste0("Vaccination Status in the U.S. By ", vbrand),
           x =" ", y = " ")+
      theme_void()+
      theme(legend.title = element_text( size = 18),
            legend.text = element_text(size = 13),
            plot.title = element_text(size=18))+
      labs(fill = "Percentage Quantile") +
      scale_fill_manual(values = colours)
}
plot2.quantile(us_states_brand, "Pfizer")









ggplotly(plot2, tooltip = c("text")) %>% 
  layout(legend = list(font = list(size=11)))




ggplotly(plot2.quantile, tooltip = c("text")) %>% 
  layout(legend = list(font = list(size=11)))
```



